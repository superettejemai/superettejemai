(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{13220:(e,t,s)=>{"use strict";s.d(t,{k5:()=>d});var r=s(12115),a={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},l=r.createContext&&r.createContext(a),i=["attr","size","title"];function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}function c(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,r)}return s}function o(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?c(Object(s),!0).forEach(function(t){var r,a,l;r=e,a=t,l=s[t],(a=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(a))in r?Object.defineProperty(r,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[a]=l}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):c(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function d(e){return t=>r.createElement(m,n({attr:o({},e.attr)},t),function e(t){return t&&t.map((t,s)=>r.createElement(t.tag,o({key:s},t.attr),e(t.child)))}(e.child))}function m(e){var t=t=>{var s,{attr:a,size:l,title:c}=e,d=function(e,t){if(null==e)return{};var s,r,a=function(e,t){if(null==e)return{};var s={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;s[r]=e[r]}return s}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)s=l[r],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(a[s]=e[s])}return a}(e,i),m=l||t.size||"1em";return t.className&&(s=t.className),e.className&&(s=(s?s+" ":"")+e.className),r.createElement("svg",n({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,a,d,{className:s,style:o(o({color:e.color||t.color},t.style),e.style),height:m,width:m,xmlns:"http://www.w3.org/2000/svg"}),c&&r.createElement("title",null,c),e.children)};return void 0!==l?r.createElement(l.Consumer,null,e=>t(e)):t(a)}},23438:(e,t,s)=>{Promise.resolve().then(s.bind(s,76025))},76025:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var r=s(95155),a=s(12115),l=s(36959);function i({onAddToCart:e}){let[t,s]=(0,a.useState)("Tous"),[i,n]=(0,a.useState)(""),[c,o]=(0,a.useState)(""),[d,m]=(0,a.useState)(1),[x,u]=(0,a.useState)([]),[h,g]=(0,a.useState)(!0),[p,f]=(0,a.useState)(null),[y,b]=(0,a.useState)(["Tous"]),[j,v]=(0,a.useState)([]),N=(0,a.useRef)(null),w=(0,a.useRef)(null),k=(0,a.useRef)(null),[S,C]=(0,a.useState)(new Date),[E,I]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=setInterval(()=>{C(new Date)},1e3);return()=>clearInterval(e)},[]);let O=(0,a.useCallback)(async(e="")=>{try{g(!0);let t=localStorage.getItem("authToken"),s=new URLSearchParams;e&&s.append("q",e);let r=await fetch(`http://localhost:4000/api/products?${s.toString()}`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!r.ok)throw Error("Failed to fetch products");let a=await r.json();u(a.products||[]);let l=a.products.filter(e=>e.category&&""!==e.category.trim()).map(e=>e.category),i=["Tous",...Array.from(new Set(l))];b(i),v(i.filter(e=>"Tous"!==e))}catch(e){f(e instanceof Error?e.message:"An error occurred")}finally{g(!1),I(!1)}},[]);(0,a.useEffect)(()=>{O()},[O]),(0,a.useEffect)(()=>{let e=setTimeout(()=>{i||c?(I(!0),O(i||c)):(I(!0),O("")),m(1)},300);return()=>clearTimeout(e)},[i,c,O]);let T=()=>{n(""),o(""),m(1),w.current?.focus()},$=()=>{o(""),n(""),m(1),k.current?.focus()},P=x.filter(e=>"Tous"===t||e.category===t),F=Math.ceil(P.length/100),q=P.slice((d-1)*100,100*d),_=e=>{N.current&&N.current.scrollBy({left:"left"===e?-200:200,behavior:"smooth"})},A=1===i.length,R=S.toLocaleDateString("fr-FR"),D=S.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),z=()=>{s("Tous"),n(""),o(""),m(1),w.current?.focus()},L=i||c;return h&&0===x.length?(0,r.jsx)("div",{className:"flex-1 py-2 sm:py-4 h-full flex flex-col",children:(0,r.jsx)("div",{className:"flex justify-center items-center h-48 sm:h-64",children:(0,r.jsx)("div",{className:"text-lg animate-pulse",children:"Chargement des produits..."})})}):p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 p-4",children:[...Array(8)].map((e,t)=>(0,r.jsx)("div",{className:"border border-gray-200  p-4 animate-pulse",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"w-18 h-18 bg-gray-200 flex-shrink-0"}),(0,r.jsxs)("div",{className:"flex-1 min-w-0 space-y-2 py-1",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200  w-3/4"}),(0,r.jsx)("div",{className:"h-3 bg-gray-200 w-1/2"}),(0,r.jsxs)("div",{className:"flex items-center gap-4 mt-1",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 w-1/4"}),(0,r.jsx)("div",{className:"h-3 bg-gray-200 w-1/3"})]})]})]}),(0,r.jsx)("div",{className:"flex-shrink-0 ml-4",children:(0,r.jsx)("div",{className:"h-12 w-12 bg-gray-200"})})]})},t))}),(0,r.jsx)("div",{className:"flex justify-center mx-auto",children:(0,r.jsx)("button",{onClick:()=>O(),className:"block mt-2 px-6 py-4 bg-gray-600 text-white hover:bg-gray-700",children:"R\xe9essayer"})})]}):(0,r.jsxs)("div",{className:"flex-1 py-2 sm:py-0 h-full flex flex-col",children:[(0,r.jsxs)("div",{className:"px-2 sm:px-4 mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[(0,r.jsx)("h1",{className:"text-xl sm:text-3xl font-black text-gray-800 mb-2 uppercase",children:"Espace Vente"}),(0,r.jsxs)("div",{className:"flex flex-row justify-between items-end xs:items-center gap-4 text-sm text-gray-600 mb-4",children:[(0,r.jsx)("span",{className:E?"animate-pulse":"",children:E?"Recherche en cours...":`${P.length} ${P.length%2==1?"produit":"produits"} ${P.length%2==1?"trouv\xe9":"trouv\xe9s"}`}),(0,r.jsx)("div",{className:"flex items-center space-x-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(l.S4m,{className:"w-3 h-3 sm:w-4 sm:h-4"}),(0,r.jsx)("span",{className:"text-xs sm:text-sm",children:R}),(0,r.jsx)(l._yE,{className:"w-3 h-3 sm:w-4 sm:h-4 ml-2"}),(0,r.jsx)("span",{className:"text-xs sm:text-sm",children:D})]})})]})]}),(0,r.jsxs)("div",{className:"space-y-3 sm:space-y-4 mb-4 sm:mb-6 px-2 sm:px-4",children:[(0,r.jsx)("div",{className:"flex flex-col xs:flex-row items-start xs:items-center gap-2 sm:gap-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2 w-full",children:[(0,r.jsx)("button",{onClick:()=>_("left"),className:"px-4 sm:px-4 py-4  border border-gray-400 text-sm hover:bg-gray-100 flex items-center justify-center shrink-0 active:bg-gray-200 transition-colors",children:(0,r.jsx)(l.atu,{className:"w-3 h-3"})}),(0,r.jsx)("div",{ref:N,className:"flex gap-1 sm:gap-2 overflow-x-auto scrollbar-hide flex-1 scroll-smooth",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:y.map(e=>(0,r.jsx)("button",{onClick:()=>{s(e),n(""),o(""),m(1)},className:`px-2 sm:px-4 py-4 sm:py-4 capitalize text-xs sm:text-sm min-w-[4rem] sm:min-w-[6rem] whitespace-nowrap shrink-0 transition-colors border ${t===e?"bg-gray-600 text-white border-gray-600":"border-gray-400 hover:bg-gray-50"}`,children:e},e))}),(0,r.jsx)("button",{onClick:()=>_("right"),className:"px-4 sm:px-4 py-4 border border-gray-400 text-sm hover:bg-gray-100 flex items-center justify-center shrink-0 active:bg-gray-200 transition-colors",children:(0,r.jsx)(l.J1z,{className:"w-3 h-3"})})]})}),(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row gap-3 w-full",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("label",{htmlFor:"product-search",className:"block text-xs font-medium text-gray-700 mb-1",children:"Recherche par nom de produit"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{ref:w,id:"product-search",type:"text",placeholder:"Rechercher un produit par nom...",value:i,onChange:e=>{n(e.target.value),o("")},className:"pl-2 sm:pl-3 pr-10 py-4 border border-gray-400 text-sm w-full focus:outline-none focus:ring-1 focus:ring-gray-500 focus:border-transparent transition-colors"}),i?(0,r.jsx)("button",{onClick:T,className:"absolute right-2 p-1 text-gray-400 hover:text-gray-600 transition-colors",title:"Effacer la recherche produit",children:(0,r.jsx)(l.IeJ,{className:"w-4 h-4"})}):(0,r.jsx)("div",{className:"absolute right-2 p-1 text-gray-400",children:(0,r.jsx)(l.YQq,{className:"w-4 h-4"})})]}),A&&(0,r.jsx)("div",{className:"absolute top-full left-0 right-0 bg-yellow-50 border border-yellow-200 text-yellow-800 text-xs px-2 p-1 mt-1 z-10",children:"La recherche se d\xe9clenche automatiquement"})]})]}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("label",{htmlFor:"category-search",className:"block text-xs font-medium text-gray-700 mb-1",children:"Recherche par cat\xe9gorie"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(l.N3f,{className:"absolute left-2 sm:left-3 text-gray-400 w-4 h-4"}),(0,r.jsx)("input",{ref:k,id:"category-search",type:"text",placeholder:"Rechercher par nom de cat\xe9gorie...",value:c,onChange:e=>{o(e.target.value),n("")},className:"pl-8 sm:pl-10 pr-10 py-4 border border-gray-400 text-sm w-full focus:outline-none focus:ring-1 focus:ring-gray-500 focus:border-transparent transition-colors",list:"category-options"}),c?(0,r.jsx)("button",{onClick:$,className:"absolute right-2 p-1 text-gray-400 hover:text-gray-600 transition-colors",title:"Effacer la recherche cat\xe9gorie",children:(0,r.jsx)(l.IeJ,{className:"w-4 h-4"})}):(0,r.jsx)("div",{className:"absolute right-2 p-1 text-gray-400",children:(0,r.jsx)(l.YQq,{className:"w-4 h-4"})})]}),(0,r.jsx)("datalist",{id:"category-options",children:j.map(e=>(0,r.jsx)("option",{value:e},e))})]})]})]}),F>1&&(0,r.jsx)("div",{className:"flex justify-center sm:justify-end",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 shrink-0",children:[(0,r.jsxs)("button",{onClick:()=>{d>1&&m(d-1)},disabled:1===d,className:`px-3 sm:px-4 py-2 border border-gray-400 text-sm transition-colors flex items-center gap-1 ${1===d?"text-gray-400 cursor-not-allowed":"hover:bg-gray-100 active:bg-gray-200"}`,children:[(0,r.jsx)(l.atu,{className:"w-3 h-3"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Pr\xe9c\xe9dent"})]}),(0,r.jsxs)("span",{className:"text-sm text-gray-600 px-2 min-w-[80px] text-center",children:[d," / ",F]}),(0,r.jsxs)("button",{onClick:()=>{d<F&&m(d+1)},disabled:d===F,className:`px-3 sm:px-4 py-2 border border-gray-400 text-sm transition-colors flex items-center gap-1 ${d===F?"text-gray-400 cursor-not-allowed":"hover:bg-gray-100 active:bg-gray-200"}`,children:[(0,r.jsx)("span",{className:"hidden sm:inline",children:"Suivant"}),(0,r.jsx)(l.J1z,{className:"w-3 h-3"})]})]})})]}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col px-2 sm:px-4",children:[("Tous"!==t||L)&&(0,r.jsxs)("div",{className:"mb-3 sm:mb-4 text-sm text-gray-600 bg-gray-50 p-2 flex flex-wrap items-center gap-2",children:["Tous"!==t&&(0,r.jsxs)("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs",children:["Cat\xe9gorie: ",t]}),i&&(0,r.jsxs)("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs flex items-center gap-1",children:['Produit: "',i,'"',(0,r.jsx)("button",{onClick:T,className:"hover:text-green-900",title:"Effacer la recherche produit",children:(0,r.jsx)(l.IeJ,{className:"w-3 h-3"})})]}),c&&(0,r.jsxs)("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs flex items-center gap-1",children:['Cat\xe9gorie: "',c,'"',(0,r.jsx)("button",{onClick:$,className:"hover:text-purple-900",title:"Effacer la recherche cat\xe9gorie",children:(0,r.jsx)(l.IeJ,{className:"w-3 h-3"})})]}),(0,r.jsx)("button",{onClick:z,className:"text-xs text-gray-500 hover:text-gray-700 underline",children:"Tout effacer"})]}),(0,r.jsx)("div",{className:"flex-1 overflow-hidden",children:0!==q.length||E?(0,r.jsx)(r.Fragment,{children:E?(0,r.jsx)("div",{className:"flex justify-center items-center h-full bg-gray-50 border-2 border-dashed border-gray-300 ",children:(0,r.jsx)("div",{className:"text-lg animate-pulse",children:"Recherche en cours..."})}):(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{className:"bg-white border h-full border-gray-300 overflow-hidden",children:(0,r.jsx)("div",{className:"overflow-y-auto scrollbar-hidden",style:{maxHeight:"calc(100vh - 420px)",minHeight:"200px"},children:(0,r.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 p-4",children:q.map(t=>{let s=(e=>{if(e.ProductImages&&e.ProductImages.length>0){let t=e.ProductImages[0].url;if(t&&""!==t.trim())return`http://localhost:4000${t}`}if(e.image&&""!==e.image.trim())if(e.image.startsWith("http"))return e.image;else return`http://localhost:4000${e.image}`;return null})(t);return(0,r.jsx)("div",{className:"border border-gray-200  p-4 hover:bg-gray-50 transition-colors",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"w-18 h-18 flex items-center justify-center bg-gray-50 flex-shrink-0",children:s?(0,r.jsx)("img",{src:s,alt:t.name,className:"w-full h-full object-contain",onError:e=>{e.target.style.display="none"}}):(0,r.jsx)("div",{className:"text-gray-400",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",className:"w-6 h-6",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M7 2.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0m4.225 4.053a.5.5 0 0 0-.577.093l-3.71 4.71-2.66-2.772a.5.5 0 0 0-.63.062L.002 13v2a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-4.5z"})})})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h3",{className:"font-semibold text-sm text-gray-800 truncate uppercase",children:t.name}),t.category&&(0,r.jsx)("p",{className:"text-xs text-gray-500 uppercase truncate",children:t.category}),(0,r.jsxs)("div",{className:"flex items-center gap-4 mt-1",children:[(0,r.jsxs)("span",{className:"font-bold text-gray-800 text-sm",children:[t.price.toFixed(3)," DT"]}),(0,r.jsx)("span",{className:`text-xs capitalize font-medium ${t.stock>10?"text-green-700":t.stock>0?"text-yellow-700":"text-red-700"}`,children:t.stock>10?`${t.stock} en stock`:t.stock>0?`Stock faible: ${t.stock}`:"Rupture de stock"})]})]})]}),(0,r.jsx)("div",{className:"shrink-0 ml-4",children:(0,r.jsx)("button",{onClick:()=>{e&&e(t)},disabled:0===t.stock,className:`
                                      flex items-center justify-center
                                      px-6 py-5
                                      
                                      transition-all
                                      active:scale-95
                                      touch-manipulation
                                      ${0===t.stock?"bg-gray-400 cursor-not-allowed":"bg-gray-600 hover:bg-gray-700 active:bg-gray-800"} 
                                      text-white
                                      text-sm font-medium
                                    `,children:(0,r.jsx)(l.QCG,{className:"w-8 h-8"})})})]})},t.id)})})})})})}):(0,r.jsx)("div",{className:"border-2 border-dashed border-gray-300  p-4 sm:p-8 h-full flex flex-col items-center justify-center bg-gradient-to-br from-gray-50 to-gray-100",children:(0,r.jsxs)("div",{className:"text-center max-w-md",children:[(0,r.jsx)("div",{className:"w-16 h-16 sm:w-24 sm:h-24 bg-white rounded-full shadow-sm flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)(l.eFZ,{className:"w-8 h-8 sm:w-12 sm:h-12 text-gray-400"})}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Aucun produit trouv\xe9"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4 text-sm sm:text-base",children:L?`Aucun produit ne correspond \xe0 votre recherche`:"Tous"!==t?`Aucun produit dans la cat\xe9gorie "${t}"`:"Aucun produit disponible"}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 justify-center",children:[(0,r.jsx)("button",{onClick:z,className:"px-4 py-2 bg-gray-600 text-white  text-sm font-medium hover:bg-gray-700 transition-colors",children:"Voir tous les produits"}),L&&(0,r.jsx)("button",{onClick:()=>{i?w.current?.focus():k.current?.focus()},className:"px-4 py-2 border border-gray-300 text-gray-700  text-sm font-medium hover:bg-gray-50 transition-colors",children:"Modifier la recherche"})]})]})})})]})]})}function n({cartItems:e,onCartUpdate:t,onCheckoutSuccess:s,currentSessionName:i}){let[n,c]=(0,a.useState)(""),[o,d]=(0,a.useState)(!1),[m,x]=(0,a.useState)(!1),[u,h]=(0,a.useState)(new Date),[g,p]=(0,a.useState)(0),[f,y]=(0,a.useState)(!1),[b,j]=(0,a.useState)(""),[v,N]=(0,a.useState)(""),[w,k]=(0,a.useState)(!1),S=(0,a.useRef)(null);(0,a.useEffect)(()=>{0===e.length&&(c(""),C())},[e]),(0,a.useEffect)(()=>{let e=setInterval(()=>{h(new Date)},1e3);return()=>clearInterval(e)},[]),(0,a.useEffect)(()=>{w&&S.current&&S.current.focus()},[w]),(0,a.useEffect)(()=>{let e=e=>{document.activeElement!==S.current&&("Enter"===e.key&&b?(I(b),j("")):1===e.key.length&&/[0-9a-zA-Z]/.test(e.key)&&j(t=>t+e.key))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[b]),(0,a.useEffect)(()=>{if(b){let e=setTimeout(()=>{j("")},500);return()=>clearTimeout(e)}},[b]),(0,a.useEffect)(()=>{if(f&&g>0){let e=setTimeout(()=>{p(g-1)},1e3);return()=>clearTimeout(e)}f&&0===g&&q()},[f,g]);let C=()=>{y(!1),p(0),d(!1)},E=async()=>{parseFloat(n)<P?alert("Montant insuffisant !"):(y(!1),p(0),await q())},I=async e=>{if(!m)try{x(!0);let t=localStorage.getItem("authToken"),s=await fetch(`http://localhost:4000/api/products?barcode=${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(s.ok){let t=await s.json();await O(t,e)}else{let s=await fetch(`http://localhost:4000/api/products?q=${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!s.ok)throw Error("Failed to fetch product");let r=await s.json();await O(r,e)}}catch(e){console.error("Error fetching product:",e),alert("Produit non trouv\xe9. V\xe9rifiez le code-barres.")}finally{x(!1),j(""),N(""),k(!1)}},O=(e,t)=>{let s=null;e.products&&e.products.length>0?s=e.products[0]:Array.isArray(e)&&e.length>0?s=e[0]:e.product?s=e.product:e.id&&(s=e),s?T(s):alert("Produit non trouv\xe9")},T=s=>{e.find(e=>e.id===s.id)?t(e.map(e=>e.id===s.id?{...e,quantity:Math.min(e.quantity+1,s.stock)}:e)):t([...e,{id:s.id,name:s.name,quantity:1,price:s.price,stock:s.stock,barcode:s.barcode,category:s.category}])},$=(s,r)=>{r<1||t(e.map(e=>e.id===s?{...e,quantity:Math.min(r,e.stock)}:e))},P=e.reduce((e,t)=>e+t.price*t.quantity,0),F=parseFloat(n)-P||0,q=async()=>{if(0!==e.length&&!o)try{d(!0);let t=localStorage.getItem("authToken");if(!t)throw Error("Authentication token not found");let r=e.map(e=>({product_id:e.id,quantity:e.quantity})),a=await fetch("http://localhost:4000/api/orders",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({items:r,paid_amount:parseFloat(n)||P,payment_method:"cash"})}),l=await a.json();if(!a.ok||!l.success)throw Error(l.message||`Failed to create order: ${a.status}`);s(l.order)}catch(e){console.error("Error creating order:",e),alert(`Erreur lors de la cr\xe9ation de la commande: ${e instanceof Error?e.message:"Unknown error"}`)}finally{d(!1),y(!1),p(0)}},_=u.toLocaleDateString("fr-FR"),A=u.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit",second:"2-digit"});return(0,r.jsxs)("div",{className:"w-full bg-white p-4 h-full lg:sticky lg:top-4 lg:h-[calc(100vh-11rem)] lg:overflow-hidden flex flex-col",children:[(0,r.jsx)("h2",{className:"font-semibold text-lg mb-4 shrink-0",children:0===e.length?"Nouvelle Commande":"Panier"}),(0,r.jsx)("div",{className:"flex-1 overflow-hidden mb-4",children:0===e.length?(0,r.jsxs)("div",{className:"border border-gray-300 h-full flex flex-col",children:[(0,r.jsx)("div",{className:"bg-gray-50 p-4 border-b border-gray-300",children:(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(l.S4m,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:_})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(l._yE,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:A})]})]})}),(0,r.jsxs)("div",{className:"flex-1 p-6 flex flex-col items-center justify-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mb-4 animate-pulse",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-8 h-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})})}),(0,r.jsx)("p",{className:"text-gray-500 text-sm mb-2",children:"En attente de produits..."}),(0,r.jsx)("p",{className:"text-gray-400 text-xs text-center",children:"Scannez ou s\xe9lectionnez des produits pour commencer la vente"}),(0,r.jsx)("div",{className:"w-full max-w-sm space-y-3 mt-6",children:[1,2,3,4].map(e=>(0,r.jsxs)("div",{className:"flex items-center space-x-3 animate-pulse",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gray-200"}),(0,r.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,r.jsx)("div",{className:"h-3 bg-gray-200 w-3/4"}),(0,r.jsx)("div",{className:"h-2 bg-gray-200 w-1/2"})]}),(0,r.jsx)("div",{className:"w-12 h-6 bg-gray-200"})]},e))})]})]}):(0,r.jsx)("div",{className:"border border-gray-300 h-full overflow-hidden flex flex-col",children:(0,r.jsx)("div",{className:"overflow-y-auto scrollbar-hide flex-1 p-3",children:e.map(s=>(0,r.jsxs)("div",{className:"flex justify-between items-start mb-3 pb-3 border-b border-gray-200 last:border-b-0 last:mb-0",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"flex justify-between items-start mb-1",children:(0,r.jsx)("p",{className:"font-semibold text-sm text-gray-800 truncate",children:s.name})}),s.category&&(0,r.jsxs)("p",{className:"flex items-center gap-2 text-xs text-gray-500 mb-2",children:[s.category," | ",(0,r.jsxs)("span",{className:"flex items-center",children:[" ",(0,r.jsx)(l.wbn,{})," ",s.barcode]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-gray-600 my-2",children:[(0,r.jsx)("label",{className:"text-xs",children:"Qt\xe9:"}),(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)("button",{onClick:()=>$(s.id,s.quantity-1),className:"w-12 h-10 border border-gray-300 flex items-center justify-center text-xl hover:bg-gray-100",children:"-"}),(0,r.jsx)("input",{type:"number",value:s.quantity,min:"1",max:s.stock,onChange:e=>$(s.id,parseInt(e.target.value)||1),className:"w-12 border border-gray-300 text-center text-xs focus:ring-1 focus:ring-gray-400 focus:outline-none py-2.5"}),(0,r.jsx)("button",{onClick:()=>$(s.id,s.quantity+1),disabled:s.quantity>=s.stock,className:`w-12 h-10 border border-gray-300 flex items-center justify-center text-base ${s.quantity>=s.stock?"text-gray-400 cursor-not-allowed":"hover:bg-gray-100"}`,children:"+"})]}),(0,r.jsxs)("span",{className:"text-xs",children:["x ",s.price.toFixed(3)," DT"]})]}),s.quantity>=s.stock&&(0,r.jsx)("p",{className:"text-xs text-red-600",children:"Stock limit\xe9"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 ml-2",children:[(0,r.jsxs)("p",{className:"font-semibold text-sm text-gray-800 whitespace-nowrap",children:[(s.price*s.quantity).toFixed(3)," DT"]}),(0,r.jsx)("button",{onClick:()=>{var r;return r=s.id,void t(e.filter(e=>e.id!==r))},className:"px-4 py-4 text-gray-400 bg-gray-100 hover:text-red-500 transition-colors",children:(0,r.jsx)(l.bJi,{size:20})})]})]},s.id))})})}),(0,r.jsx)("div",{className:"shrink-0 space-y-4 border-t border-gray-200 pt-4",children:e.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center border-t border-gray-200 pt-2",children:[(0,r.jsx)("span",{className:"font-bold text-lg",children:"Total:"}),(0,r.jsxs)("span",{className:"font-bold text-lg",children:[P.toFixed(3)," DT"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold mb-2",children:"Paiement"}),(0,r.jsx)("input",{type:"number",value:n,onChange:e=>c(e.target.value),className:"w-full border px-3 py-4 text-sm mb-3 focus:outline-none border-gray-300 focus:ring-1 focus:ring-gray-500",placeholder:"0.00",step:"0.01",min:"0"}),(0,r.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 mb-4",children:[(0,r.jsx)("span",{children:"Monnaie \xe0 rendre:"}),(0,r.jsxs)("span",{className:`font-semibold text-base ${F>=0?"text-green-700":"text-red-700"}`,children:[F.toFixed(3)," DT"]})]})]}),f?(0,r.jsx)("div",{className:"space-y-3",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:["Impression dans ",(0,r.jsxs)("span",{className:"font-bold text-blue-600",children:[g,"s"]})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsxs)("button",{onClick:C,className:"flex-1 py-4 bg-red-600 hover:bg-red-700 text-white text-sm font-medium transition-colors",children:["Annuler (",g,"s)"]}),(0,r.jsx)("button",{onClick:E,disabled:o,className:`flex-1 py-4 text-sm font-medium transition-colors ${o?"bg-gray-400 cursor-not-allowed text-gray-200":"bg-green-600 hover:bg-green-700 text-white"}`,children:o?"Traitement...":"Imprimer maintenant"})]})]})}):o?(0,r.jsx)("button",{disabled:!0,className:"w-full py-4 bg-gray-400 text-gray-200 text-sm font-medium cursor-not-allowed",children:"Traitement en cours..."}):(0,r.jsx)("button",{onClick:()=>{parseFloat(n)<P?alert("Montant insuffisant !"):(y(!0),p(10))},disabled:0===e.length,className:`w-full py-4 text-sm font-medium transition-colors ${0===e.length?"bg-gray-400 cursor-not-allowed text-gray-200":"bg-gray-800 hover:bg-gray-900 text-white"}`,children:"Valider et imprimer"})]})})]})}function c({order:e,cartItems:t,onPrintTicket:s}){let[i,n]=(0,a.useState)(null),[c,o]=(0,a.useState)(!0),[d,m]=(0,a.useState)(null),[x,u]=(0,a.useState)(2),[h,g]=(0,a.useState)(!1),[p,f]=(0,a.useState)(!1),[y,b]=(0,a.useState)(null),j=(0,a.useRef)(!1),v=new Date;v.toLocaleDateString("fr-FR"),v.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),(0,a.useEffect)(()=>{w()},[]),(0,a.useEffect)(()=>{if(p||j.current)return;let e=setInterval(()=>{u(t=>t<=1?(clearInterval(e),N(),0):t-1)},1e3);return()=>clearInterval(e)},[p]);let N=async()=>{if(p||j.current)return void console.log("\uD83D\uDED1 Print already executed, skipping");j.current=!0,g(!0),f(!0),b(null);try{console.log("\uD83D\uDDA8️ Sending print request..."),console.log("\uD83D\uDCE6 Cart items:",t),console.log("\uD83D\uDCB0 Order:",e);let r=await fetch("http://localhost:4000/api/print",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:e||{},cartItems:t||[]})}),a=await r.json();if(console.log("\uD83D\uDCC4 Print response:",a),!r.ok||!a.success)throw Error(a.error||a.message||"Print failed");console.log("✅ Print request successful"),s()}catch(e){console.error("❌ Error printing receipt:",e),b(e instanceof Error?e.message:"Printing failed")}finally{g(!1)}},w=async()=>{try{o(!0),m(null);let e=localStorage.getItem("authToken")||sessionStorage.getItem("authToken");if(!e){m("Authentication required"),o(!1);return}let t=await fetch("http://localhost:4000/api/templates/current",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(t.ok){let e=await t.json();n(e)}else console.warn("No template found, using default"),n(k())}catch(e){console.error("Failed to load template:",e),n(k())}finally{o(!1)}},k=()=>({business_name:"Nom de l'entreprise",address:"Adresse Line",phone:"+216 28-888-XXX",email:"",website:"",tax_number:"",thank_you_message:"Merci pour votre achat !",return_policy:"Retours accept\xe9s dans un d\xe9lai d'un jour avec le re\xe7u original."}),S=t.reduce((e,t)=>e+t.price*t.quantity,0),C=e?.paid_amount||S,E=C-S,I=()=>i?.logo_url?i.logo_url:i?.logo_path?`http://localhost:4000/${i.logo_path}`:null;return c?(0,r.jsx)("div",{className:"w-full bg-white shadow rounded p-4 h-full flex justify-center items-center",children:(0,r.jsx)("div",{className:"text-lg animate-pulse",children:"Chargement du template..."})}):(0,r.jsxs)("div",{className:"w-full bg-white shadow rounded p-4 h-full flex flex-col relative",children:[h&&(0,r.jsx)("div",{className:"absolute inset-0 bg-white bg-opacity-90 backdrop-blur-sm z-10 flex flex-col items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-blue-100 rounded-full mx-auto mb-4 flex items-center justify-center animate-pulse",children:(0,r.jsx)(l.C5Z,{className:"w-8 h-8 text-blue-600"})}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Impression en cours..."}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Veuillez patienter pendant l'impression du ticket"})]})}),(0,r.jsxs)("div",{className:"text-center mb-4",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-full mx-auto mb-3 flex items-center justify-center",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Paiement R\xe9ussi !"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Transaction trait\xe9e avec succ\xe8s"})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,r.jsxs)("div",{className:"bg-white border border-gray-300 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"text-center mb-4",children:[(0,r.jsx)("div",{className:"w-12 h-12 border border-gray-200 rounded-md mb-2 bg-gray-50 overflow-hidden flex items-center justify-center mx-auto",children:I()?(0,r.jsx)("img",{src:I()||"",alt:"Logo",className:"w-full h-full object-contain"}):(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-100 text-gray-400",children:(0,r.jsx)(l.C5Z,{})})}),(0,r.jsx)("p",{className:"font-semibold text-sm",children:i?.business_name||"Nom de l'entreprise"}),(0,r.jsxs)("p",{className:"text-xs text-gray-600",children:[i?.address&&(0,r.jsxs)(r.Fragment,{children:[i.address,(0,r.jsx)("br",{})]}),i?.phone&&(0,r.jsxs)(r.Fragment,{children:[i.phone,(0,r.jsx)("br",{})]}),i?.email&&(0,r.jsxs)(r.Fragment,{children:[i.email,(0,r.jsx)("br",{})]}),i?.website&&(0,r.jsxs)(r.Fragment,{children:[i.website,(0,r.jsx)("br",{})]})]})]}),(0,r.jsx)("hr",{className:"my-3 border-gray-300"}),t.map((e,t)=>(0,r.jsxs)("div",{className:"flex justify-between text-xs mb-2",children:[(0,r.jsxs)("div",{children:[e.name," x",e.quantity]}),(0,r.jsxs)("div",{children:[(e.price*e.quantity).toFixed(3)," DT"]})]},t)),(0,r.jsx)("hr",{className:"my-3 border-gray-300"}),(0,r.jsxs)("div",{className:"text-xs space-y-1",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Total:"}),(0,r.jsxs)("span",{children:[S.toFixed(3)," DT"]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Montant re\xe7u:"})," ",(0,r.jsxs)("span",{children:[C.toFixed(3)," DT"]})]}),(0,r.jsxs)("div",{className:"flex justify-between font-semibold",children:[(0,r.jsx)("span",{children:"Monnaie rendue:"})," ",(0,r.jsxs)("span",{className:E>=0?"text-green-600":"text-red-600",children:[E.toFixed(3)," DT"]})]})]}),(0,r.jsxs)("div",{className:"mt-4 text-center text-xs text-gray-700 italic",children:[i?.thank_you_message||"Merci pour votre achat !",(0,r.jsx)("br",{}),i?.return_policy||"Retours accept\xe9s dans un d\xe9lai d'un jour avec le re\xe7u original."]})]})}),(0,r.jsx)("div",{className:"text-center mt-4 text-sm text-gray-600",children:x>0&&!p?`Impression automatique dans ${x} seconde${1!==x?"s":""}...`:h?"Impression en cours...":y?"Erreur d'impression":"Impression termin\xe9e"}),y&&(0,r.jsx)("button",{onClick:s,className:"mt-4 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Fermer"})]})}function o(){let[e,t]=(0,a.useState)([]),[s,l]=(0,a.useState)(!1),[o,d]=(0,a.useState)(null),[m,x]=(0,a.useState)([]),[u,h]=(0,a.useState)(""),g=()=>`tab_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,p=e=>e.map((e,t)=>({...e,name:`Caisse ${t+1}`,originalNumber:t+1}));(0,a.useEffect)(()=>{let e=g();x([{id:e,cartItems:[],createdAt:Date.now(),name:"Caisse 1",isActive:!0,originalNumber:1}]),h(e);let s=localStorage.getItem(`cart_${e}`);s&&t(JSON.parse(s))},[]),(0,a.useEffect)(()=>{if(u&&!s){let t=m.map(t=>t.id===u?{...t,cartItems:e,isActive:!0}:{...t,isActive:!1});x(t),localStorage.setItem("tabSessions",JSON.stringify(t)),localStorage.setItem(`cart_${u}`,JSON.stringify(e))}},[e,u,s]),(0,a.useEffect)(()=>{let e=localStorage.getItem("tabSessions");if(e){let s=p(JSON.parse(e));x(s);let r=s.find(e=>e.isActive)||s[0];r&&(h(r.id),t(r.cartItems))}},[]);let f=e=>{let s=m.find(t=>t.id===e);if(s){h(e),t(s.cartItems),l(!1),d(null);let r=m.map(t=>t.id===e?{...t,isActive:!0}:{...t,isActive:!1});x(r),localStorage.setItem("tabSessions",JSON.stringify(r))}},y=()=>{let e=m.find(e=>e.id===u);return e?.name||"Caisse"},b=e=>e.cartItems.reduce((e,t)=>e+t.quantity,0);return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"bg-gray-200 text-white px-4 pt-0  flex justify-between items-center border-b border-gray-300",children:[(0,r.jsx)("div",{className:"flex items-center space-x-2 flex-1 overflow-x-auto",children:m.map(e=>(0,r.jsxs)("div",{onClick:()=>f(e.id),className:`
                flex items-center space-x-2 px-3 py-2 rounded-t-lg cursor-pointer min-w-0 max-w-xs transition-colors relative group
                ${e.id===u?"bg-white text-gray-800 font-semibold":"bg-gray-600 hover:bg-gray-700"}
                ${s&&e.id===u?"border-2 border-green-500":""}
              `,children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 flex-1",children:[(0,r.jsx)("span",{className:"truncate",title:e.name,onDoubleClick:t=>{t.stopPropagation();let s=prompt("Renommer la caisse:",e.name);s&&s.trim()&&!s.trim().toLowerCase().startsWith("caisse")?((e,t)=>{if(t.trim().toLowerCase().startsWith("caisse"))return alert("Les noms personnalis\xe9s ne peuvent pas commencer par 'Caisse'. Utilisez un nom diff\xe9rent.");let s=m.map(s=>s.id===e?{...s,name:t.trim()}:s);x(s),localStorage.setItem("tabSessions",JSON.stringify(s))})(e.id,s.trim()):s&&s.trim().toLowerCase().startsWith("caisse")&&alert("Les noms personnalis\xe9s ne peuvent pas commencer par 'Caisse'")},children:e.name}),!e.name.startsWith("Caisse ")&&(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),(e=>{if(m.find(t=>t.id===e)){let t=m.findIndex(t=>t.id===e),s=`Caisse ${t+1}`,r=m.map(t=>t.id===e?{...t,name:s}:t);x(r),localStorage.setItem("tabSessions",JSON.stringify(r))}})(e.id)},className:"text-xs opacity-70 hover:opacity-100",title:"R\xe9tablir le nom par d\xe9faut",children:"↶"})]}),b(e)>0&&(0,r.jsx)("span",{className:`
                  rounded-full w-5 h-5 text-xs inline-flex items-center justify-center shrink-0
                  ${e.id===u?"bg-green-600 text-white":"bg-gray-500 text-white"}
                `,children:b(e)}),s&&e.id===u&&(0,r.jsx)("span",{className:"w-2 h-2 bg-green-500 rounded-full shrink-0",title:"Paiement r\xe9ussi"}),m.length>1&&(0,r.jsx)("button",{onClick:t=>((e,t)=>{if(t.stopPropagation(),m.length<=1)return void alert("Vous ne pouvez pas fermer la derni\xe8re caisse !");m.find(t=>t.id===e);let s=p(m.filter(t=>t.id!==e));if(x(s),localStorage.setItem("tabSessions",JSON.stringify(s)),localStorage.removeItem(`cart_${e}`),e===u){let t=m.findIndex(t=>t.id===e);f(t>0&&s[t-1]?.id||s[0].id)}})(e.id,t),className:`
                    w-8 h-8 rounded-full flex px-4 py-2 items-center justify-center text-base transition-opacity shrink-0
                    ${e.id===u?"opacity-0 group-hover:opacity-100 hover:bg-gray-200":"opacity-70 hover:opacity-100 hover:bg-gray-600"}
                  `,title:"Fermer cette caisse",children:"\xd7"})]},e.id))}),(0,r.jsx)("div",{className:"flex space-x-2 ml-4 shrink-0",children:(0,r.jsxs)("button",{onClick:()=>{let e,s=g(),r=(e=m.length+1,`Caisse ${e}`),a={id:s,cartItems:[],createdAt:Date.now(),name:r,isActive:!0,originalNumber:m.length+1},i=m.map(e=>({...e,isActive:!1}));i.push(a);let n=p(i);x(n),h(s),t([]),l(!1),d(null),localStorage.setItem("tabSessions",JSON.stringify(n))},className:"px-3 py-2 bg-gray-600 hover:bg-green-700 rounded-t-lg text-sm flex items-center space-x-1 transition-colors",title:"Ouvrir une nouvelle caisse",children:[(0,r.jsx)("span",{className:"text-lg",children:"+"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Nouvelle Caisse"})]})})]}),(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row w-full p-2 sm:p-4 flex-1 gap-4 bg-gray-50",children:[(0,r.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,r.jsx)(i,{onAddToCart:e=>{s||t(t=>t.find(t=>t.id===e.id)?t.map(t=>t.id===e.id?{...t,quantity:Math.min(t.quantity+1,e.stock)}:t):[...t,{id:e.id,name:e.name,quantity:1,price:e.price,stock:e.stock,barcode:e.barcode,category:e.category}])}})}),(0,r.jsx)("div",{className:"w-full lg:w-96 xl:w-96 2xl:w-md shrink-0",children:s?(0,r.jsx)(c,{order:o,cartItems:e,onPrintTicket:()=>{if(m.find(e=>e.id===u)){let e=m.map(e=>e.id===u?{...e,cartItems:[]}:e);x(e),localStorage.setItem("tabSessions",JSON.stringify(e)),localStorage.removeItem(`cart_${u}`)}t([]),l(!1),d(null)},onCancelOperation:()=>{l(!1),d(null)}}):(0,r.jsx)(n,{cartItems:e,onCartUpdate:e=>{s||t(e)},onCheckoutSuccess:e=>{d(e),l(!0)},currentSessionName:y()})})]}),(0,r.jsxs)("div",{className:"bg-gray-800 text-white px-4 sm:fixed bottom-0 w-full  text-xs flex justify-between items-center shrink-0 border-t border-gray-700",children:[(0,r.jsxs)("span",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:"font-medium",children:y()}),(0,r.jsx)("span",{className:"text-gray-300",children:"•"}),s?(0,r.jsxs)("span",{className:"text-green-300 flex items-center",children:[(0,r.jsx)("span",{className:"w-2 h-2 bg-green-300 rounded-full mr-2 animate-pulse"}),"Paiement r\xe9ussi - Pr\xeat pour nouvelle commande"]}):(0,r.jsxs)("span",{className:"text-gray-300",children:[e.reduce((e,t)=>e+t.quantity,0)," article(s) •",e.length," produit(s) •",e.reduce((e,t)=>e+t.price*t.quantity,0).toFixed(3)," DT"]})]}),(0,r.jsxs)("span",{className:"text-gray-300 bg-gray-700 px-2 py-1 rounded text-xs",children:[m.length," caisse(s) ouverte(s)"]})]})]})}}},e=>{e.O(0,[87,441,794,358],()=>e(e.s=23438)),_N_E=e.O()}]);