(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[108],{24494:(e,s,a)=>{Promise.resolve().then(a.bind(a,35617))},35617:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>r});var t=a(95155),l=a(12115);function r(){let[e,s]=(0,l.useState)({companyName:"",address:"",phone:"",email:"",website:"",vatNumber:""}),[a,r]=(0,l.useState)({thankYouMessage:"",returnPolicy:""}),[d,m]=(0,l.useState)(null),[x,u]=(0,l.useState)(null),[h,p]=(0,l.useState)(null),[g,b]=(0,l.useState)(!0),[j,f]=(0,l.useState)(!1),[y,v]=(0,l.useState)(null),N=(0,l.useRef)(null),w=()=>localStorage.getItem("authToken")||sessionStorage.getItem("authToken");(0,l.useEffect)(()=>{k()},[]);let k=async()=>{try{b(!0),v(null);let e=w();if(!e){v("Authentication required. Please log in."),b(!1);return}let a=await fetch("http://localhost:4000/api/templates/current",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(a.ok){let e=await a.json();s({companyName:e.business_name||"",address:e.address||"",phone:e.phone||"",email:e.email||"",website:e.website||"",vatNumber:e.tax_number||""}),r({thankYouMessage:e.thank_you_message||"",returnPolicy:e.return_policy||""}),e.logo_url?p(e.logo_url):e.logo_path&&p(`http://localhost:4000/${e.logo_path}`)}else 401===a.status?v("Authentication failed. Please log in again."):403===a.status?window.location.href="/403":v("Failed to load template")}catch(e){console.error("Failed to load template:",e),v("Network error. Please check your connection.")}finally{b(!1)}},C=(0,l.useCallback)((e,a)=>{s(s=>({...s,[e]:a}))},[]),P=(0,l.useCallback)((e,s)=>{r(a=>({...a,[e]:s}))},[]),S=async()=>{try{f(!0),v(null);let s=w();if(!s)return void v("Authentication required. Please log in.");let t=new FormData;t.append("business_name",e.companyName),t.append("address",e.address),t.append("phone",e.phone),t.append("email",e.email),t.append("website",e.website),t.append("tax_number",e.vatNumber),t.append("thank_you_message",a.thankYouMessage),t.append("return_policy",a.returnPolicy),d&&t.append("logo",d);let l=await fetch("http://localhost:4000/api/templates",{method:"POST",headers:{Authorization:`Bearer ${s}`},body:t});if(l.ok)await l.json(),alert("Template saved successfully!"),m(null),N.current&&(N.current.value=""),await k();else if(401===l.status)v("Authentication failed. Please log in again.");else if(403===l.status)window.location.href="/403";else{let e=await l.json();throw Error(e.message||"Failed to save template")}}catch(e){console.error("Save error:",e),v(e instanceof Error?e.message:"Failed to save template")}finally{f(!1)}};return g?(0,t.jsx)("div",{className:"min-h-screen bg-white p-10 text-gray-800 flex items-center justify-center",children:(0,t.jsx)("div",{className:"text-lg",children:"Loading template..."})}):(0,t.jsxs)("div",{className:"min-h-screen bg-white p-10 text-gray-800",children:[y&&(0,t.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"text-red-600 text-sm",children:y}),(0,t.jsx)("button",{onClick:()=>v(null),className:"ml-auto text-red-500 hover:text-red-700",children:"\xd7"})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-10",children:[(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Renseignement Commercial"}),(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsx)(n,{businessInfo:e,onChange:C})})]}),(0,t.jsx)(i,{onLogoChange:e=>{let s=e.target.files?.[0];if(s){if(!s.type.startsWith("image/"))return void v("Please select an image file");if(s.size>2097152)return void v("File size must be less than 2MB");m(s),v(null);let e=new FileReader;e.onload=e=>{u(e.target?.result)},e.readAsDataURL(s)}},onRemoveLogo:()=>{m(null),u(null),p(null),N.current&&(N.current.value="")},logoPreview:x,existingLogoPath:h,fileInputRef:N}),(0,t.jsx)(o,{receiptContent:a,onChange:P}),(0,t.jsx)("div",{className:"flex justify-end pt-4",children:(0,t.jsx)("button",{onClick:S,disabled:j,className:"px-6 py-4 bg-gray-800 text-white text-sm hover:bg-gray-900 disabled:opacity-50",children:j?"Saving...":"Save Template"})})]}),(0,t.jsx)(c,{businessInfo:e,receiptContent:a,logoPreview:x,existingLogoPath:h})]})]})}let n=({businessInfo:e,onChange:s})=>(0,t.jsx)(t.Fragment,{children:[{key:"companyName",label:"Nom de l'entreprise",value:e.companyName},{key:"address",label:"Adresse",value:e.address},{key:"phone",label:"Num\xe9ro de t\xe9l\xe9phone",value:e.phone},{key:"email",label:"Email",value:e.email},{key:"website",label:"Website",value:e.website},{key:"vatNumber",label:"Num\xe9ro de TVA",value:e.vatNumber}].map(({key:e,label:a,value:l})=>(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:a}),(0,t.jsx)("input",{type:"text",value:l,onChange:a=>s(e,a.target.value),className:"w-full border border-gray-300 px-3 py-4 text-sm focus:ring-1 focus:ring-gray-500 focus:outline-none"})]},e))}),i=({onLogoChange:e,onRemoveLogo:s,logoPreview:a,existingLogoPath:l,fileInputRef:r})=>(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Logo d'entreprise"}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 p-4 cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>{r.current?.click()},children:(0,t.jsx)("div",{className:"w-20 h-20 flex items-center justify-center bg-gray-100 overflow-hidden",children:a||l?(0,t.jsx)("img",{src:a||l||"",alt:"Company logo",className:"w-full h-full object-contain"}):(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("input",{type:"file",ref:r,onChange:e,accept:"image/*",className:"hidden"}),(0,t.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:["T\xe9l\xe9charger le logo (Max 2MB)",(0,t.jsx)("br",{}),(0,t.jsx)("span",{className:"text-xs",children:"Formats support\xe9s: JPG, PNG, GIF"})]}),(a||l)&&(0,t.jsx)("button",{type:"button",onClick:s,className:"text-xs text-red-600 hover:text-red-800",children:"Supprimer le logo"})]})]})]}),o=({receiptContent:e,onChange:s})=>(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Infos Client"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Message de remerciement"}),(0,t.jsx)("textarea",{value:e.thankYouMessage,onChange:e=>s("thankYouMessage",e.target.value),className:"w-full border border-gray-300 px-3 py-4 text-sm h-16 focus:ring-1 focus:ring-gray-500 focus:outline-none"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Politique de retour"}),(0,t.jsx)("textarea",{value:e.returnPolicy,onChange:e=>s("returnPolicy",e.target.value),className:"w-full border border-gray-300 px-3 py-4 text-sm h-16 focus:ring-1 focus:ring-gray-500 focus:outline-none"})]})]})]}),c=({businessInfo:e,receiptContent:s,logoPreview:a,existingLogoPath:l})=>{let r=new Date().toLocaleDateString("fr-FR"),n=new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"});return(0,t.jsxs)("div",{className:"lg:sticky lg:top-10 self-start h-fit",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Aper\xe7u en Direct"}),(0,t.jsxs)("div",{className:"border border-gray-300 p-6 w-full max-w-sm mx-auto bg-white shadow-sm",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center text-center mb-4",children:[(0,t.jsx)("div",{className:"w-12 h-12  mb-2 bg-gray-50 overflow-hidden flex items-center justify-center",children:a||l?(0,t.jsx)("img",{src:a||l||"",alt:"Company logo",className:"w-full h-full object-contain"}):(0,t.jsx)("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-xs text-gray-400",children:"Logo"})})}),(0,t.jsx)("h3",{className:"font-semibold",children:e.companyName||"Receiptify Corp."}),(0,t.jsxs)("p",{className:"text-xs text-gray-600 leading-4",children:[e.address||"123 Main St, Anytown, CA 90210",(0,t.jsx)("br",{}),e.phone||"(555) 123-4567",(0,t.jsx)("br",{}),e.email||"support@receiptify.com",(0,t.jsx)("br",{}),e.website||"www.receiptify.com",(0,t.jsx)("br",{}),"N\xb0 de TVA : ",e.vatNumber.replace("TAX-ID: ","")||"987654321"]})]}),(0,t.jsx)("hr",{className:"my-4 border-gray-200"}),(0,t.jsxs)("div",{className:"text-xs mb-3",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Date:"}),(0,t.jsx)("span",{children:r})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Heure:"}),(0,t.jsx)("span",{children:n})]})]}),(0,t.jsx)("hr",{className:"my-4 border-gray-200"}),(0,t.jsxs)("div",{className:"text-xs",children:[(0,t.jsx)("p",{className:"font-semibold mb-1",children:"Articles"}),(0,t.jsx)("div",{className:"border-t border-dotted border-gray-400 my-1"}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Produit A (1x)"}),(0,t.jsx)("span",{children:"25,00"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Service B (2x)"}),(0,t.jsx)("span",{children:"31,00"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Produit C (1x)"}),(0,t.jsx)("span",{children:"5,25"})]}),(0,t.jsx)("div",{className:"border-t border-dotted border-gray-400 my-2"}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Sous-total :"}),(0,t.jsx)("span",{children:"61,25"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Taxe (8 %) :"}),(0,t.jsx)("span",{children:"4,90"})]}),(0,t.jsx)("div",{className:"border-t border-gray-300 my-2"}),(0,t.jsxs)("div",{className:"flex justify-between font-semibold text-sm",children:[(0,t.jsx)("span",{children:"TOTAL :"}),(0,t.jsx)("span",{children:"66,15"})]})]}),(0,t.jsxs)("div",{className:"mt-4 text-center text-xs text-gray-700 italic",children:[s.thankYouMessage||"Merci pour votre achat !",(0,t.jsx)("br",{}),(0,t.jsx)("span",{className:"not-italic",children:s.returnPolicy||"Retours accept\xe9s dans un d\xe9lai d'un jour avec le re\xe7u original. Certaines exclusions s'appliquent."})]})]})]})}}},e=>{e.O(0,[441,794,358],()=>e(e.s=24494)),_N_E=e.O()}]);