(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{27776:(e,t,r)=>{"use strict";r.d(t,{default:()=>u});var a=r(95155),s=r(12115),o=r(73321);let l={src:"/_next/static/media/AEVE.f40955f5.png",height:362,width:1200,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAACCAMAAABSSm3fAAAAG1BMVEUAAAAAAAAAAAABAQEAAAADAwMAAAAAAAABAQE4WGoBAAAACXRSTlOwzm96kVVmO4LggFcEAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAGklEQVR4nGNgZWRhZuJgYGJgYWBgZ2Rj4AAAAcwANLy0MXAAAAAASUVORK5CYII=",blurWidth:8,blurHeight:2},n="/_next/static/media/user.6be69166.png";var i=r(5772);let c=()=>{let[e,t]=(0,s.useState)(!1),[r,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1),[h,m]=(0,s.useState)("JD"),g=(0,o.usePathname)(),p=(0,o.useRouter)();(0,s.useEffect)(()=>{let e=()=>u(window.scrollY>10);return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),(0,s.useEffect)(()=>{let e=localStorage.getItem("user");if(e)try{let t=JSON.parse(e),r="JD";if(t.firstName||t.lastName){let e=t.firstName?t.firstName.charAt(0):"",a=t.lastName?t.lastName.charAt(0):"";r=(e+a).toUpperCase()}else t.name&&(r=t.name.split(" ").map(e=>e.charAt(0)).join("").toUpperCase().slice(0,2));m(r)}catch(e){console.error("Error parsing user data:",e)}},[]);let x=e=>"/"===e?"/"===g:g.startsWith(e),f=e=>{let t=x(e);return`${t?"text-gray-600 font-bold":"text-gray-500 hover:text-gray-600 font-normal"}`},b=()=>{localStorage.removeItem("authToken"),localStorage.removeItem("userData"),localStorage.removeItem("cart"),c(!1),t(!1),p.push("/auth/connexion")};return(0,a.jsxs)("nav",{className:`fixed top-0 left-0 w-full border-b border-gray-300 px-4 sm:px-8 py-2 z-50 transition-all duration-300 ${d?"shadow-md bg-gray-100/95 backdrop-blur-sm":"bg-gray-100"}`,children:[(0,a.jsxs)("div",{className:"max-w-full mx-auto flex items-center justify-between",children:[(0,a.jsxs)("a",{href:"/",className:"font-bold font-mono text-gray-800",children:[(0,a.jsx)(i.default,{src:l,alt:"POS System Logo",className:"w-20 h-auto"}),(0,a.jsx)("span",{className:"text-[9px] ",children:"Powered by AFEKPLUS Technologies"})]}),(0,a.jsxs)("div",{className:"hidden sm:flex space-x-8",children:[(0,a.jsx)("a",{href:"/",className:f("/"),children:"Ventes"}),(0,a.jsx)("a",{href:"/gestion",className:f("/gestion"),children:"Gestion"}),(0,a.jsx)("a",{href:"/rapports",className:f("/rapports"),children:"Rapports"}),(0,a.jsx)("a",{href:"/parametres",className:f("/parametres"),children:"Param\xe8tres"})]}),(0,a.jsxs)("div",{className:"hidden sm:flex items-center space-x-6 relative",children:[(0,a.jsxs)("a",{href:"/aide",className:f("/parametres")+" flex items-center gap-1",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M12 20c4.418 0 8-3.582   8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8z"})}),(0,a.jsx)("span",{children:"Aide"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{onClick:()=>c(e=>!e),className:"w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center cursor-pointer focus:outline-none focus:ring-1 focus:ring-gray-500","aria-haspopup":"true","aria-expanded":r,children:(0,a.jsx)(i.default,{src:n,alt:"Ø´Ø¹Ø§Ø± Ù…Ø³ØªØ®Ø¯Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹",fill:!0,className:"object-cover rounded-full"})}),r&&(0,a.jsxs)("div",{className:"origin-top-right absolute right-0 mt-3.5 w-48 shadow-lg bg-white ring-1 ring-gray-500 ring-opacity-5 z-20 rounded-md",onMouseLeave:()=>c(!1),children:[(0,a.jsx)("a",{href:"/parametres/update",className:"block px-4 py-4 text-gray-700 hover:bg-gray-100 border-b border-gray-100 rounded-t-md",children:"Profil"}),(0,a.jsx)("a",{href:"/parametres",className:"block px-4 py-4 text-gray-700 hover:bg-gray-100 border-b border-gray-100",children:"Param\xe8tres"}),(0,a.jsx)("button",{onClick:b,className:"block w-full text-left px-4 py-4 text-gray-700 hover:bg-gray-100 hover:text-red-600 transition-colors rounded-b-md",children:"D\xe9connexion"})]})]})]}),(0,a.jsx)("button",{onClick:()=>t(e=>!e),className:"sm:hidden text-gray-700 hover:text-gray-500 focus:outline-none focus:ring-1 focus:ring-gray-500",children:e?(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}):(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})})]}),e&&(0,a.jsxs)("div",{className:"sm:hidden mt-3 border-t border-gray-200 pt-3 space-y-3",children:[(0,a.jsxs)("div",{className:"flex flex-col space-y-2 text-left",children:[(0,a.jsx)("a",{href:"/",className:`block px-2 ${x("/")?"text-black font-bold":"text-gray-500 hover:text-black font-medium"}`,onClick:()=>t(!1),children:"Accueil"}),(0,a.jsx)("a",{href:"/gestion",className:`block px-2 ${x("/gestion")?"text-black font-bold":"text-gray-500 hover:text-black font-medium"}`,onClick:()=>t(!1),children:"Gestion de produits"}),(0,a.jsx)("a",{href:"/rapports",className:`block px-2 ${x("/rapports")?"text-black font-bold":"text-gray-500 hover:text-black font-medium"}`,onClick:()=>t(!1),children:"Rapports"}),(0,a.jsx)("a",{href:"/parametres",className:`block px-2 ${x("/parametres")?"text-black font-bold":"text-gray-500 hover:text-black font-medium"}`,onClick:()=>t(!1),children:"Param\xe8tres"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-4 px-2",children:[(0,a.jsxs)("button",{className:"flex items-center text-gray-700 hover:text-blue-600 font-medium gap-1",type:"button","aria-label":"Aide",children:[(0,a.jsx)("span",{children:"Aide"}),(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M12 20c4.418 0 8-3.582   8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8z"})})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>c(e=>!e),className:"w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center focus:outline-none focus:ring-1 focus:ring-gray-500","aria-haspopup":"true","aria-expanded":r,children:[(0,a.jsx)(i.default,{src:n,alt:"Ø´Ø¹Ø§Ø± Ù…Ø³ØªØ®Ø¯Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹",fill:!0,className:"object-cover rounded-full"}),"              "]}),r&&(0,a.jsxs)("div",{className:"origin-top-right absolute right-0 mt-4 w-48 shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-20 rounded-md",onMouseLeave:()=>c(!1),children:[(0,a.jsx)("a",{href:"#",className:"block px-4 py-4 text-gray-700 hover:bg-gray-100 border-b border-gray-100 rounded-t-md",onClick:()=>c(!1),children:"Profil"}),(0,a.jsx)("a",{href:"/parametres",className:"block px-4 py-4 text-gray-700 hover:bg-gray-100 border-b border-gray-100",onClick:()=>{c(!1),t(!1)},children:"Param\xe8tres"}),(0,a.jsx)("button",{onClick:b,className:"block w-full text-left px-4 py-4 text-gray-700 hover:bg-gray-100 hover:text-red-600 transition-colors",children:"D\xe9connexion"})]})]})]})]})]})};var d=r(59185);function u({children:e}){let t=(0,o.useRouter)(),r=(0,o.usePathname)(),l=r.includes("/auth"),[n,i]=(0,s.useState)(!0),[u,h]=(0,s.useState)(null),[m,g]=(0,s.useState)(null),[p,x]=(0,s.useState)(""),f=async()=>{try{x("updating"),console.log("\uD83D\uDD50 Triggering auto-update via backend...");let e=await fetch("http://localhost:4000/api/database/auto-update",{method:"POST",headers:{"Content-Type":"application/json"}});if(e.ok){let t=await e.json();console.log("âœ… Auto-update successful:",t);let r=Date.now();g(r),localStorage.setItem("lastupdate",r.toString()),x("success"),setTimeout(()=>x(""),5e3)}else{let t=await e.json();throw Error(t.error||"Backend update failed")}}catch(e){console.error("âŒ Auto-update failed:",e),x("error"),setTimeout(()=>x(""),1e4)}},b=async()=>{try{let e=localStorage.getItem("lastupdate"),t=Date.now();!e||t-parseInt(e)>36e5?(console.log(`ðŸ• Update needed. Last update: ${e?new Date(parseInt(e)).toLocaleString():"never"}`),await f()):(console.log(`â° No update needed. Last update: ${new Date(parseInt(e)).toLocaleString()}`),g(parseInt(e)))}catch(e){console.error("Error checking update status:",e)}},A=async()=>{try{let e=await fetch("http://localhost:4000/api/database/check-auto-update");if(e.ok){let t=await e.json();console.log("Auto-update check:",t)}}catch(e){console.log("Auto-update endpoint not available")}};return((0,s.useEffect)(()=>{let e=localStorage.getItem("lastupdate");e&&g(parseInt(e))},[]),(0,s.useEffect)(()=>{A(),b();let e=setInterval(()=>{b()},6e4);return()=>clearInterval(e)},[]),(0,s.useEffect)(()=>{let e=async()=>{let e=localStorage.getItem("authToken");try{if(!e||!(await d.A.get("http://localhost:4000/api/auth/verify-token",{headers:{Authorization:`Bearer ${e}`}})).data.valid)return void t.replace("/auth/connexion");let a=(await d.A.get("http://localhost:4000/api/users/me",{headers:{Authorization:`Bearer ${e}`}})).data.user;if(h(a.role),r.includes("/gestion/edit")&&"worker"===a.role)return void t.replace("/403")}catch(e){console.error("Access check error:",e),t.replace("/auth/connexion")}finally{i(!1)}};l||e()},[r,t,l]),(0,s.useEffect)(()=>{"worker"===u&&(r.includes("/gestion/edit")||r.includes("/parametres"))&&t.replace("/403")},[r,u,t]),!l&&n)?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:(0,a.jsx)("div",{className:"flex flex-col items-center",children:(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-gray-300 border-t-gray-500 rounded-full animate-spin"})})}):(0,a.jsxs)(a.Fragment,{children:[!l&&(0,a.jsx)(c,{}),(0,a.jsx)("main",{className:`min-h-full w-full mx-auto ${!l?"pt-16":""}`,children:e})]})}},65862:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,66872,23)),Promise.resolve().then(r.bind(r,27776)),Promise.resolve().then(r.t.bind(r,78688,23))},66872:()=>{},78688:e=>{e.exports={style:{fontFamily:"'roboto', 'roboto Fallback'"},className:"__className_b796b7",variable:"__variable_b796b7"}}},e=>{e.O(0,[566,772,619,718,441,794,358],()=>e(e.s=65862)),_N_E=e.O()}]);