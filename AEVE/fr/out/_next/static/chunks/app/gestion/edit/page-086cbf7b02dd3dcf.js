(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[119],{22567:(e,r,t)=>{Promise.resolve().then(t.bind(t,41916))},41916:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>n});var a=t(95155),i=t(12115),s=t(73321),l=t(80642),o=t(9673);let n=()=>{let e=(0,s.useSearchParams)(),r=(0,s.useRouter)(),t=e.get("id"),[n,c]=(0,i.useState)({productName:"",productDescription:"",price:0,purchasePrice:0,category:"",quantityInStock:0,barcode:"",sku:""}),[d,u]=(0,i.useState)({file:null,previewUrl:""}),[m,p]=(0,i.useState)(!1),[g,h]=(0,i.useState)(!0),[x,y]=(0,i.useState)(null),[f,b]=(0,i.useState)(""),[v,j]=(0,i.useState)(!1),[w,N]=(0,i.useState)([]),[k,P]=(0,i.useState)([]),[S,C]=(0,i.useState)(!1);(0,i.useEffect)(()=>{t?(L(),E()):(y({type:"error",text:"ID du produit manquant"}),h(!1))},[t]);let E=async()=>{try{let e=localStorage.getItem("authToken");if(!e)return;let r=await fetch("http://localhost:4000/api/products",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(r.ok){let e=((await r.json()).products||[]).filter(e=>e.category&&""!==e.category.trim()).map(e=>e.category),t=Array.from(new Set(e));N(t)}}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration des cat\xe9gories:",e),N([])}},I=e=>{let r=e.target.value;if(c(e=>({...e,category:r})),r.trim()){let e=w.filter(e=>e.toLowerCase().includes(r.toLowerCase()));P(e),C(e.length>0)}else P([]),C(!1)};(0,i.useEffect)(()=>{if(v){let e=setTimeout(()=>{r.push("/gestion")},1500);return()=>clearTimeout(e)}},[v,r]);let L=async()=>{try{h(!0);let e=localStorage.getItem("authToken");if(!e)throw Error("Token d'authentification non trouv\xe9");let r=await fetch(`http://localhost:4000/api/products/${t}`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!r.ok)throw await r.text(),Error(`\xc9chec de la r\xe9cup\xe9ration du produit: ${r.status} ${r.statusText}`);let a=await r.json(),i=a.product||a;if(!i)throw Error("Aucune donn\xe9e produit re\xe7ue du serveur");if(c({productName:i.name||"",productDescription:i.description||"",price:i.price||0,purchasePrice:i.cost_price||0,category:i.category||"",quantityInStock:i.stock||0,barcode:i.barcode||"",sku:i.sku||""}),i.ProductImages&&i.ProductImages.length>0){let e=i.ProductImages.find(e=>e.is_primary)||i.ProductImages[0],r=`http://localhost:4000${e.url}`;b(r),u(e=>({...e,previewUrl:r}))}else b(""),u({file:null,previewUrl:""});y(null)}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration du produit:",e),y({type:"error",text:`Erreur lors du chargement du produit: ${e instanceof Error?e.message:"Erreur inconnue"}`})}finally{h(!1)}},T=e=>{let{name:r,value:t}=e.target;"category"===r?I(e):c(e=>({...e,[r]:r.includes("price")||r.includes("quantityInStock")?Number(t):t}))},q=async()=>{if(n.productName.trim()?n.price<=0?(y({type:"error",text:"Le prix doit \xeatre sup\xe9rieur \xe0 0"}),!1):!(n.quantityInStock<0)||(y({type:"error",text:"La quantit\xe9 en stock ne peut pas \xeatre n\xe9gative"}),!1):(y({type:"error",text:"Le nom du produit est requis"}),!1)){p(!0),y(null);try{let e=localStorage.getItem("authToken");if(!e)throw Error("Token d'authentification non trouv\xe9");let r=new FormData;r.append("name",n.productName),r.append("description",n.productDescription),r.append("price",n.price.toString()),r.append("cost_price",n.purchasePrice.toString()),r.append("stock",n.quantityInStock.toString()),r.append("category",n.category),r.append("barcode",n.barcode),r.append("sku",n.sku),d.file&&r.append("productImage",d.file);let a=await fetch(`http://localhost:4000/api/products/${t}`,{method:"PUT",headers:{Authorization:`Bearer ${e}`},body:r});if(!a.ok)throw await a.text(),Error(`\xc9chec de la mise \xe0 jour du produit: ${a.status}`);j(!0)}catch(e){console.error("Erreur lors de la mise \xe0 jour du produit:",e),y({type:"error",text:e instanceof Error?e.message:"Erreur lors de la mise \xe0 jour du produit"})}finally{p(!1)}}},z={hidden:{opacity:0},visible:{opacity:1},exit:{opacity:0}};return g?(0,a.jsx)("div",{className:"h-full bg-gray-50 flex items-center justify-center p-4",children:(0,a.jsx)("div",{className:"w-full h-full max-w-full max-h-[90vh] grid grid-rows-[auto_1fr] gap-4",children:(0,a.jsxs)("div",{className:"flex justify-center items-center h-full",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"}),(0,a.jsx)("span",{className:"ml-4 text-gray-600",children:"Chargement du produit..."})]})})}):(0,a.jsx)("div",{className:"h-full bg-gray-50 flex items-center justify-center p-4",dir:"ltr",children:(0,a.jsxs)("div",{className:"w-full h-full max-w-full max-h-[90vh] grid grid-rows-[auto_1fr] gap-4",children:[x&&"error"===x.type&&(0,a.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 text-red-700",children:x.text}),(0,a.jsx)(l.N,{children:v&&(0,a.jsxs)(o.P.div,{className:"fixed inset-0 z-50 flex items-center justify-center p-4",variants:z,initial:"hidden",animate:"visible",exit:"exit",children:[(0,a.jsx)(o.P.div,{className:"absolute inset-0 bg-white/80 backdrop-blur-sm",variants:z,initial:"hidden",animate:"visible",exit:"exit"}),(0,a.jsx)(o.P.div,{className:"relative bg-white p-8 mx-4 max-w-sm w-full border border-gray-100",variants:{hidden:{opacity:0,scale:.8,y:-50},visible:{opacity:1,scale:1,y:0,transition:{type:"spring",damping:25,stiffness:300}},exit:{opacity:0,scale:.8,y:50,transition:{duration:.2}}},initial:"hidden",animate:"visible",exit:"exit",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(o.P.div,{className:"mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-green-50 mb-6 border border-green-100",variants:{hidden:{scale:0,rotate:-180},visible:{scale:1,rotate:0,transition:{type:"spring",stiffness:200,damping:15,delay:.2}}},initial:"hidden",animate:"visible",children:(0,a.jsx)(o.P.svg,{className:"h-10 w-10 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",initial:{pathLength:0},animate:{pathLength:1},transition:{delay:.5,duration:.3},children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),(0,a.jsx)(o.P.h3,{className:"text-2xl font-bold text-gray-900 mb-3",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},children:"Succ\xe8s!"}),(0,a.jsx)(o.P.p,{className:"text-gray-600 mb-6",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4},children:"Produit mis \xe0 jour avec succ\xe8s"}),(0,a.jsx)(o.P.div,{className:"text-sm text-gray-500",initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},children:"Redirection vers la liste des produits..."}),(0,a.jsx)(o.P.div,{className:"w-full bg-gray-200 rounded-full h-1.5 mt-4 overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:(0,a.jsx)(o.P.div,{className:"bg-green-500 h-1.5 rounded-full",initial:{width:"0%"},animate:{width:"100%"},transition:{duration:1.5,ease:"linear"}})})]})})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 h-full overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-white border border-gray-300 flex flex-col",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800 text-center",children:"D\xe9tails du produit"})}),(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center p-6",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full min-h-[200px] bg-gray-50 border-2 border-dashed border-gray-300 py-10 gap-y-4 hover:border-gray-400 transition cursor-pointer",children:[(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-camera w-16 h-16 text-gray-400",viewBox:"0 0 16 16",children:[(0,a.jsx)("path",{d:"M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 6.827 3h2.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 12.828 5H14a1 1 0 0 1 1 1zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4z"}),(0,a.jsx)("path",{d:"M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5m0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7M3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0"})]}),(0,a.jsx)("p",{className:"text-gray-600 text-lg font-medium text-center",children:"Scanner le code-barres du produit"}),(0,a.jsx)("p",{className:"text-gray-500 text-sm text-center",children:"Cliquez pour simuler le scan"}),n.barcode&&(0,a.jsxs)("div",{className:"mt-4 p-3 bg-green-50 border border-green-200",children:[(0,a.jsx)("p",{className:"text-green-700 text-sm font-medium",children:"Code-barres g\xe9n\xe9r\xe9:"}),(0,a.jsx)("p",{className:"text-green-800 font-mono text-lg",children:n.barcode})]})]})})]}),(0,a.jsx)("div",{className:"bg-white border border-gray-300 flex flex-col overflow-hidden",children:(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-gray-700 text-sm font-medium",children:"Image du produit"}),(0,a.jsxs)("div",{className:"flex items-end gap-4 py-3",children:[(0,a.jsx)("div",{className:"w-24 h-24 border border-gray-200 bg-gray-100 flex items-center justify-center text-gray-400 text-sm overflow-hidden",children:d.previewUrl?(0,a.jsx)("img",{src:d.previewUrl,alt:"Aper\xe7u du produit",className:"w-full h-full object-cover"}):f?(0,a.jsx)("img",{src:f,alt:"Aper\xe7u du produit",className:"w-full h-full object-cover"}):(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",className:"bi bi-image-alt w-8 h-8",viewBox:"0 0 16 16",children:(0,a.jsx)("path",{d:"M7 2.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0m4.225 4.053a.5.5 0 0 0-.577.093l-3.71 4.71-2.66-2.772a.5.5 0 0 0-.63.062L.002 13v2a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-4.5z"})})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("input",{type:"file",id:"productImage",accept:"image/*",onChange:e=>{let r=e.target.files?.[0];if(r){if(!r.type.startsWith("image/"))return void y({type:"error",text:"Veuillez t\xe9l\xe9charger un fichier image"});if(r.size>5242880)return void y({type:"error",text:"La taille de l'image doit \xeatre inf\xe9rieure \xe0 5 Mo"});let e=URL.createObjectURL(r);u({file:r,previewUrl:e}),b(""),y(null)}},className:"hidden"}),(0,a.jsxs)("label",{htmlFor:"productImage",className:"inline-flex items-center gap-2 px-4 py-4 border border-gray-300 bg-white text-gray-600 text-sm font-normal hover:bg-gray-100 transition cursor-pointer",children:[(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",className:"bi bi-upload w-4 h-4",viewBox:"0 0 16 16",children:[(0,a.jsx)("path",{d:"M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"}),(0,a.jsx)("path",{d:"M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708z"})]}),f?"Changer l'image":"T\xe9l\xe9charger une image"]}),d.file&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:[d.file.name," (",(d.file.size/1024/1024).toFixed(3)," MB)"]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Nom du produit *"}),(0,a.jsx)("input",{type:"text",name:"productName",value:n.productName,onChange:T,placeholder:"Nom du produit al\xe9atoire",className:"mt-1 w-full border border-gray-300 p-2.5 text-gray-700 focus:ring-1 focus:ring-gray-500 focus:outline-none",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),(0,a.jsx)("textarea",{name:"productDescription",value:n.productDescription,onChange:T,rows:3,placeholder:"Description du nom du produit al\xe9atoire...",className:"txtarea mt-1 w-full border border-gray-300 p-2.5 text-gray-700 focus:ring-1 focus:ring-gray-500 focus:outline-none"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Prix (DT) *"}),(0,a.jsx)("input",{type:"number",name:"price",value:n.price,onChange:T,placeholder:"2",min:"0",step:"0.01",className:"mt-1 w-full border border-gray-300 p-2.5 focus:ring-1 focus:ring-gray-500 focus:outline-none",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Prix d'achat (DT)"}),(0,a.jsx)("input",{type:"number",name:"purchasePrice",value:n.purchasePrice,onChange:T,placeholder:"1",min:"0",step:"0.01",className:"mt-1 w-full border border-gray-300 p-2.5 focus:ring-1 focus:ring-gray-500 focus:outline-none"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Cat\xe9gorie"}),(0,a.jsx)("input",{type:"text",name:"category",value:n.category,onChange:I,placeholder:"Cat\xe9gorie",className:"mt-1 w-full border border-gray-300 p-2.5 focus:ring-1 focus:ring-gray-500 focus:outline-none"}),S&&(0,a.jsx)("div",{className:"absolute w-full bg-white border border-gray-300 mt-1 shadow-lg z-10 max-h-40 overflow-y-auto",children:k.map((e,r)=>(0,a.jsx)("div",{className:"p-2 text-gray-700 cursor-pointer hover:bg-gray-100",onClick:()=>{c(r=>({...r,category:e})),P([]),C(!1)},children:e},r))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Quantit\xe9 en stock"}),(0,a.jsx)("input",{type:"number",name:"quantityInStock",value:n.quantityInStock,onChange:T,placeholder:"50",min:"0",className:"mt-1 w-full border border-gray-300 p-2.5 focus:ring-1 focus:ring-gray-500 focus:outline-none"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Code-barres"}),(0,a.jsx)("input",{type:"text",name:"barcode",value:n.barcode,onChange:T,className:"mt-1 w-full border border-gray-300 p-2.5 text-gray-700 focus:ring-1 focus:ring-gray-500 focus:outline-none bg-gray-50"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"SKU"}),(0,a.jsx)("input",{type:"text",name:"sku",value:n.sku,onChange:T,className:"mt-1 w-full border border-gray-300 p-2.5 text-gray-700 focus:ring-1 focus:ring-gray-500 focus:outline-none bg-gray-50",readOnly:!0})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-200",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{r.push("/gestion")},className:"px-8 py-4 bg-gray-500 text-white hover:bg-gray-600 transition font-medium",children:"Annuler"}),(0,a.jsx)("button",{type:"button",onClick:q,className:"px-6 py-4 bg-green-700 text-white hover:bg-green-800 transition font-medium disabled:bg-green-500 disabled:cursor-not-allowed",disabled:m,children:m?"Chargement...":"Mettre \xe0 jour le produit"})]})]})})]})]})})}},73321:(e,r,t)=>{"use strict";var a=t(74645);t.o(a,"usePathname")&&t.d(r,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(r,{useSearchParams:function(){return a.useSearchParams}})}},e=>{e.O(0,[900,441,794,358],()=>e(e.s=22567)),_N_E=e.O()}]);