(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[730],{32927:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>l});var a=t(95155),s=t(73321),o=t(12115);let l=()=>{let[e,r]=(0,o.useState)({productName:"",productDescription:"",price:"",purchasePrice:"",category:"",quantityInStock:"",barcode:"",sku:""}),[t,l]=(0,o.useState)({file:null,previewUrl:""}),[i,c]=(0,o.useState)(!1),[n,d]=(0,o.useState)(null),[u,g]=(0,o.useState)([]),[p,m]=(0,o.useState)([]),[h,x]=(0,o.useState)(!1);(0,o.useEffect)(()=>{f()},[]);let f=async()=>{try{let e=localStorage.getItem("authToken");if(!e)return;let r=await fetch("http://localhost:4000/api/products",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(r.ok){let e=((await r.json()).products||[]).filter(e=>e.category&&""!==e.category.trim()).map(e=>e.category),t=Array.from(new Set(e));g(t)}}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration des cat\xe9gories:",e),g([])}},y=e=>{let t=e.target.value;if(r(e=>({...e,category:t})),t.trim()){let e=u.filter(e=>e.toLowerCase().includes(t.toLowerCase()));m(e),x(e.length>0)}else m([]),x(!1)},b=e=>{let{name:t,value:a}=e.target;"category"===t?y(e):r(e=>({...e,[t]:t.includes("price")||t.includes("quantityInStock")?Number(a):a}))},v=e=>{if(!e)return"";let r=e.substring(0,3).toUpperCase().replace(/\s/g,""),t=Math.floor(1e3+9e3*Math.random());return`${r}-${t}`},j=async()=>{if(e.productName.trim()?e.price<=0?(d({type:"error",text:"Le prix doit \xeatre sup\xe9rieur \xe0 0"}),!1):!(e.quantityInStock<0)||(d({type:"error",text:"La quantit\xe9 en stock ne peut pas \xeatre n\xe9gative"}),!1):(d({type:"error",text:"Le nom du produit est requis"}),!1)){c(!0),d(null);try{let a=localStorage.getItem("authToken");if(!a)throw Error("Token d'authentification non trouv\xe9");let s=new FormData;s.append("name",e.productName),s.append("description",e.productDescription),s.append("price",e.price.toString()),s.append("cost_price",e.purchasePrice.toString()),s.append("stock",e.quantityInStock.toString()),s.append("category",e.category),s.append("barcode",e.barcode),s.append("sku",e.sku||v(e.productName)),t.file&&s.append("productImage",t.file);let o=await fetch("http://localhost:4000/api/products",{method:"POST",headers:{Authorization:`Bearer ${a}`},body:s});if(!o.ok){let e=await o.json();throw Error(e.message||"\xc9chec de la cr\xe9ation du produit")}let i=await o.json();d({type:"success",text:"Produit cr\xe9\xe9 avec succ\xe8s!"}),r({productName:"",productDescription:"",price:"",purchasePrice:"",category:"",quantityInStock:"",barcode:"",sku:""}),l({file:null,previewUrl:""}),console.log("Produit cr\xe9\xe9:",i)}catch(e){console.error("Erreur lors de la cr\xe9ation du produit:",e),d({type:"error",text:e instanceof Error?e.message:"\xc9chec de la cr\xe9ation du produit"})}finally{c(!1)}}},N=(0,s.useRouter)();return(0,a.jsx)("div",{className:"h-full bg-gray-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"w-full h-full max-w-full max-h-[90vh] grid grid-rows-[auto_1fr] gap-4",children:[n&&(0,a.jsx)("div",{className:`p-4 ${"success"===n.type?"bg-green-50 border border-green-200 text-green-700":"bg-red-50 border border-red-200 text-red-700"}`,children:n.text}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 h-full overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-white border border-gray-300 flex flex-col",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800 text-center",children:"D\xe9tails du produit"})}),(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center p-6",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full min-h-[200px] bg-gray-50 border-2 border-dashed border-gray-300 py-10 gap-y-4 hover:border-gray-400 transition cursor-pointer",children:[(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-camera w-16 h-16 text-gray-400",viewBox:"0 0 16 16",children:[(0,a.jsx)("path",{d:"M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 6.827 3h2.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 12.828 5H14a1 1 0 0 1 1 1zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4z"}),(0,a.jsx)("path",{d:"M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5m0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7M3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0"})]}),(0,a.jsx)("p",{className:"text-gray-600 text-lg font-medium text-center",children:"Scanner le code-barres du produit"}),e.barcode&&(0,a.jsxs)("div",{className:"mt-4 p-3 bg-green-50 border border-green-200",children:[(0,a.jsx)("p",{className:"text-green-700 text-sm font-medium",children:"Code-barres g\xe9n\xe9r\xe9:"}),(0,a.jsx)("p",{className:"text-green-800 font-mono text-lg",children:e.barcode})]})]})})]}),(0,a.jsx)("div",{className:"bg-white border border-gray-300 flex flex-col overflow-hidden",children:(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-gray-700 text-sm font-medium",children:"Image du produit"}),(0,a.jsxs)("div",{className:"flex items-end gap-4 py-3",children:[(0,a.jsx)("div",{className:"w-24 h-24 border border-gray-200 bg-gray-100 flex items-center justify-center text-gray-400 text-sm overflow-hidden",children:t.previewUrl?(0,a.jsx)("img",{src:t.previewUrl,alt:"Aper\xe7u du produit",className:"w-full h-full object-cover"}):(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",className:"bi bi-image-alt w-8 h-8",viewBox:"0 0 16 16",children:(0,a.jsx)("path",{d:"M7 2.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0m4.225 4.053a.5.5 0 0 0-.577.093l-3.71 4.71-2.66-2.772a.5.5 0 0 0-.63.062L.002 13v2a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-4.5z"})})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("input",{type:"file",id:"productImage",accept:"image/*",onChange:e=>{let r=e.target.files?.[0];if(r){if(!r.type.startsWith("image/"))return void d({type:"error",text:"Veuillez t\xe9l\xe9charger un fichier image valide"});if(r.size>5242880)return void d({type:"error",text:"La taille de l'image doit \xeatre inf\xe9rieure \xe0 5 Mo"});let e=URL.createObjectURL(r);l({file:r,previewUrl:e}),d(null)}},className:"hidden"}),(0,a.jsxs)("label",{htmlFor:"productImage",className:"inline-flex items-center gap-2 px-4 py-4 border border-gray-300 bg-white text-gray-600 text-sm font-normal hover:bg-gray-100 transition cursor-pointer",children:[(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",className:"bi bi-upload w-4 h-4",viewBox:"0 0 16 16",children:[(0,a.jsx)("path",{d:"M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"}),(0,a.jsx)("path",{d:"M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708z"})]}),"T\xe9l\xe9charger une image"]}),t.file&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:[t.file.name," (",(t.file.size/1024/1024).toFixed(3)," MB)"]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Nom du produit *"}),(0,a.jsx)("input",{type:"text",name:"productName",value:e.productName,onChange:e=>{let{value:t}=e.target;r(e=>({...e,productName:t,sku:v(t)}))},placeholder:"Nom du produit al\xe9atoire",className:"mt-1 w-full border border-gray-300 p-2.5 text-gray-700 focus:ring-1 focus:ring-gray-500 focus:outline-none",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),(0,a.jsx)("textarea",{name:"productDescription",value:e.productDescription,onChange:b,rows:3,placeholder:"Description du nom du produit al\xe9atoire...",className:"txtarea mt-1 w-full border border-gray-300 p-2.5 text-gray-700 focus:ring-1 focus:ring-gray-500 focus:outline-none"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Prix (DT) *"}),(0,a.jsx)("input",{type:"number",name:"price",value:e.price,onChange:b,placeholder:"2",min:"0",step:"0.01",className:"mt-1 w-full border border-gray-300 p-2.5 focus:ring-1 focus:ring-gray-500 focus:outline-none",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Prix d'achat (DT)"}),(0,a.jsx)("input",{type:"number",name:"purchasePrice",value:e.purchasePrice,onChange:b,placeholder:"1",min:"0",step:"0.01",className:"mt-1 w-full border border-gray-300 p-2.5 focus:ring-1 focus:ring-gray-500 focus:outline-none"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Cat\xe9gorie"}),(0,a.jsx)("input",{type:"text",name:"category",value:e.category,onChange:y,placeholder:"Cat\xe9gorie",className:"mt-1 w-full border border-gray-300 p-2.5 focus:ring-1 focus:ring-gray-500 focus:outline-none"}),h&&(0,a.jsx)("div",{className:"absolute w-full bg-white border border-gray-300 mt-1 shadow-lg z-10 max-h-40 overflow-y-auto",children:p.map((e,t)=>(0,a.jsx)("div",{className:"p-2 text-gray-700 cursor-pointer hover:bg-gray-100",onClick:()=>{r(r=>({...r,category:e})),m([]),x(!1)},children:e},t))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Quantit\xe9 en stock"}),(0,a.jsx)("input",{type:"number",name:"quantityInStock",value:e.quantityInStock,onChange:b,placeholder:"50",min:"0",className:"mt-1 w-full border border-gray-300 p-2.5 focus:ring-1 focus:ring-gray-500 focus:outline-none"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Code-barres"}),(0,a.jsx)("input",{type:"text",name:"barcode",value:e.barcode,onChange:b,className:"mt-1 w-full border border-gray-300 p-2.5 text-gray-700 focus:ring-1 focus:ring-gray-500 focus:outline-none bg-gray-50"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"SKU"}),(0,a.jsx)("input",{type:"text",name:"sku",value:e.sku,onChange:b,className:"mt-1 w-full border border-gray-300 p-2.5 text-gray-700 focus:ring-1 focus:ring-gray-500 focus:outline-none bg-gray-50",readOnly:!0})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-200",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{r({productName:"",productDescription:"",price:"",purchasePrice:"",category:"",quantityInStock:"",barcode:"",sku:""}),l({file:null,previewUrl:""}),d(null),m([]),x(!1),c(!1),N.push("/gestion")},className:"px-8 py-4 bg-gray-500 text-white hover:bg-gray-600 transition font-medium",children:"Annuler"}),(0,a.jsx)("button",{type:"button",onClick:j,className:"px-6 py-4 bg-green-700 text-white hover:bg-green-800 transition font-medium disabled:bg-green-500 disabled:cursor-not-allowed",disabled:i,children:i?"Chargement...":"Ajouter le produit"})]})]})})]})]})})}},73321:(e,r,t)=>{"use strict";var a=t(74645);t.o(a,"usePathname")&&t.d(r,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(r,{useSearchParams:function(){return a.useSearchParams}})},79244:(e,r,t)=>{Promise.resolve().then(t.bind(t,32927))}},e=>{e.O(0,[441,794,358],()=>e(e.s=79244)),_N_E=e.O()}]);